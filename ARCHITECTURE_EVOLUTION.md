# ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ¼”è¿›æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†éªŒè¯ç è¯†åˆ«ç³»ç»Ÿä»å½“å‰å•ä½“æ¶æ„å‘ç°ä»£åŒ–å¾®æœåŠ¡æ¶æ„çš„æ¼”è¿›è·¯å¾„ï¼ŒåŒ…æ‹¬å…·ä½“çš„æŠ€æœ¯é€‰å‹ã€å®æ–½æ­¥éª¤å’Œæœ€ä½³å®è·µã€‚

## ğŸ¯ å½“å‰æ¶æ„åˆ†æ

### ç°æœ‰æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å½“å‰å•ä½“æ¶æ„                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Flask     â”‚  â”‚  Clean Final    â”‚   â”‚
â”‚  â”‚   API       â”‚â”€â”€â”‚  Recognizer     â”‚   â”‚
â”‚  â”‚             â”‚  â”‚                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                  â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Test API   â”‚  â”‚   Captcha       â”‚   â”‚
â”‚  â”‚             â”‚  â”‚  Recognizer     â”‚   â”‚
â”‚  â”‚             â”‚  â”‚   Engine        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ä¼˜åŠ¿
- âœ… **ç®€å•ç›´æ¥**: éƒ¨ç½²å’Œç»´æŠ¤ç®€å•
- âœ… **æ€§èƒ½ä¼˜ç§€**: æ— ç½‘ç»œå¼€é”€ï¼Œå“åº”å¿«é€Ÿ
- âœ… **å¼€å‘æ•ˆç‡**: å¿«é€Ÿè¿­ä»£ï¼Œå®¹æ˜“è°ƒè¯•

### æ¶æ„é™åˆ¶
- âŒ **æ‰©å±•æ€§å·®**: éš¾ä»¥æ°´å¹³æ‰©å±•
- âŒ **æŠ€æœ¯æ ˆå›ºåŒ–**: éš¾ä»¥å¼•å…¥æ–°æŠ€æœ¯
- âŒ **å•ç‚¹æ•…éšœ**: ä¸€ä¸ªç»„ä»¶æ•…éšœå½±å“å…¨ç³»ç»Ÿ
- âŒ **å›¢é˜Ÿåä½œ**: å¤šäººå¼€å‘å®¹æ˜“å†²çª

## ğŸš€ ç›®æ ‡æ¶æ„è®¾è®¡

### å¾®æœåŠ¡æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway                           â”‚
â”‚                    (Kong/Envoy)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     è®¤è¯æˆæƒæœåŠ¡          â”‚ â”‚ â”‚      è´Ÿè½½å‡è¡¡å™¨         â”‚
    â”‚   (Auth Service)         â”‚ â”‚ â”‚   (Load Balancer)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒä¸šåŠ¡æœåŠ¡å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      æ–‡æœ¬è¯†åˆ«æœåŠ¡         â”‚   â”‚  â”‚    è®¡ç®—è¯†åˆ«æœåŠ¡     â”‚ â”‚
â”‚  â”‚   (Text Recognition)     â”‚   â”‚  â”‚ (Calc Recognition)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     å›¾åƒå¤„ç†æœåŠ¡          â”‚   â”‚  â”‚     æ‰¹é‡å¤„ç†æœåŠ¡    â”‚ â”‚
â”‚  â”‚  (Image Processing)      â”‚   â”‚  â”‚  (Batch Processing) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ”¯æ’‘æœåŠ¡å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      ç”¨æˆ·ç®¡ç†æœåŠ¡         â”‚   â”‚  â”‚     é…ç½®ç®¡ç†æœåŠ¡    â”‚ â”‚
â”‚  â”‚   (User Management)      â”‚   â”‚  â”‚ (Config Management) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      ç›‘æ§å‘Šè­¦æœåŠ¡         â”‚   â”‚  â”‚     æ–‡ä»¶å­˜å‚¨æœåŠ¡    â”‚ â”‚
â”‚  â”‚   (Monitor & Alert)      â”‚   â”‚  â”‚  (File Storage)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      å…³ç³»æ•°æ®åº“           â”‚   â”‚  â”‚      ç¼“å­˜æ•°æ®åº“     â”‚ â”‚
â”‚  â”‚    (PostgreSQL)          â”‚   â”‚  â”‚      (Redis)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      æ¶ˆæ¯é˜Ÿåˆ—             â”‚   â”‚  â”‚     å¯¹è±¡å­˜å‚¨        â”‚ â”‚
â”‚  â”‚    (RabbitMQ)            â”‚   â”‚  â”‚      (MinIO)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ æ¼”è¿›è·¯å¾„

### Phase 1: åŸºç¡€è®¾æ–½å‡†å¤‡ (Week 1-2)

#### 1.1 å®¹å™¨åŒ–æ”¹é€ 
```dockerfile
# Dockerfileä¼˜åŒ–
FROM python:3.9-slim

# å¤šé˜¶æ®µæ„å»º
FROM python:3.9-slim as builder
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.9-slim
COPY --from=builder /root/.local /root/.local
COPY . /app
WORKDIR /app

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:5000/api/health || exit 1

CMD ["python", "clean_api.py"]
```

#### 1.2 Docker Composeç¼–æ’
```yaml
# docker-compose.yml
version: '3.8'
services:
  captcha-api:
    build: .
    ports:
      - "5000:5000"
    environment:
      - REDIS_URL=redis://redis:6379
      - DB_URL=postgresql://user:pass@postgres:5432/captcha
    depends_on:
      - redis
      - postgres
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: captcha
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### Phase 2: æœåŠ¡æ‹†åˆ† (Week 3-4)

#### 2.1 è¯†åˆ«æœåŠ¡æ‹†åˆ†
```python
# text_recognition_service.py
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

app = FastAPI(title="Text Recognition Service")

class RecognitionRequest(BaseModel):
    image_data: bytes
    options: dict = {}

class RecognitionResponse(BaseModel):
    result: str
    confidence: float
    processing_time: float

@app.post("/recognize", response_model=RecognitionResponse)
async def recognize_text(request: RecognitionRequest):
    # æ–‡æœ¬è¯†åˆ«é€»è¾‘
    pass

@app.get("/health")
async def health_check():
    return {"status": "healthy"}
```

#### 2.2 APIç½‘å…³é…ç½®
```yaml
# kong.yml
_format_version: "3.0"

services:
  - name: text-recognition
    url: http://text-recognition:8001
    routes:
      - name: text-recognition-route
        paths:
          - /api/v1/text/recognize

  - name: calc-recognition
    url: http://calc-recognition:8002
    routes:
      - name: calc-recognition-route
        paths:
          - /api/v1/calc/recognize

plugins:
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
  
  - name: cors
    config:
      origins:
        - "*"
```

### Phase 3: æ•°æ®å±‚æ”¹é€  (Week 5-6)

#### 3.1 æ•°æ®åº“è®¾è®¡
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    api_key VARCHAR(64) UNIQUE NOT NULL,
    quota_limit INTEGER DEFAULT 1000,
    quota_used INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- è¯†åˆ«è®°å½•è¡¨
CREATE TABLE recognition_logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    image_hash VARCHAR(64) NOT NULL,
    recognition_type VARCHAR(20) NOT NULL,
    result TEXT,
    confidence FLOAT,
    processing_time FLOAT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_configs (
    key VARCHAR(50) PRIMARY KEY,
    value TEXT NOT NULL,
    description TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_recognition_logs_user_id ON recognition_logs(user_id);
CREATE INDEX idx_recognition_logs_created_at ON recognition_logs(created_at);
CREATE INDEX idx_recognition_logs_image_hash ON recognition_logs(image_hash);
```

#### 3.2 ç¼“å­˜ç­–ç•¥
```python
# cache_service.py
import redis
import json
from typing import Optional, Any

class CacheService:
    def __init__(self, redis_url: str):
        self.redis = redis.from_url(redis_url)
    
    async def get_recognition_result(self, image_hash: str) -> Optional[dict]:
        """è·å–è¯†åˆ«ç»“æœç¼“å­˜"""
        key = f"recognition:{image_hash}"
        result = self.redis.get(key)
        return json.loads(result) if result else None
    
    async def set_recognition_result(self, image_hash: str, result: dict, ttl: int = 3600):
        """è®¾ç½®è¯†åˆ«ç»“æœç¼“å­˜"""
        key = f"recognition:{image_hash}"
        self.redis.setex(key, ttl, json.dumps(result))
    
    async def get_user_quota(self, user_id: int) -> Optional[dict]:
        """è·å–ç”¨æˆ·é…é¢ç¼“å­˜"""
        key = f"quota:{user_id}"
        result = self.redis.get(key)
        return json.loads(result) if result else None
    
    async def update_user_quota(self, user_id: int, used: int, limit: int):
        """æ›´æ–°ç”¨æˆ·é…é¢ç¼“å­˜"""
        key = f"quota:{user_id}"
        quota_data = {"used": used, "limit": limit}
        self.redis.setex(key, 300, json.dumps(quota_data))  # 5åˆ†é’ŸTTL
```

### Phase 4: ç›‘æ§å’Œè¿ç»´ (Week 7-8)

#### 4.1 Prometheusç›‘æ§
```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'captcha-services'
    static_configs:
      - targets: 
        - 'text-recognition:8001'
        - 'calc-recognition:8002'
        - 'api-gateway:8000'
    metrics_path: /metrics
    scrape_interval: 5s

  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']

  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']
```

#### 4.2 Grafanaä»ªè¡¨æ¿
```json
{
  "dashboard": {
    "title": "éªŒè¯ç è¯†åˆ«ç³»ç»Ÿç›‘æ§",
    "panels": [
      {
        "title": "APIè¯·æ±‚é‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{service}}"
          }
        ]
      },
      {
        "title": "è¯†åˆ«å‡†ç¡®ç‡",
        "type": "stat",
        "targets": [
          {
            "expr": "recognition_accuracy_ratio",
            "legendFormat": "å‡†ç¡®ç‡"
          }
        ]
      },
      {
        "title": "å“åº”æ—¶é—´åˆ†å¸ƒ",
        "type": "heatmap",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          }
        ]
      }
    ]
  }
}
```

## ğŸ”§ æŠ€æœ¯é€‰å‹è¯¦è§£

### åç«¯æ¡†æ¶å¯¹æ¯”
| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **FastAPI** | é«˜æ€§èƒ½ã€è‡ªåŠ¨æ–‡æ¡£ã€ç±»å‹æ£€æŸ¥ | ç›¸å¯¹è¾ƒæ–° | æ¨èç”¨äºæ–°æœåŠ¡ |
| **Flask** | ç®€å•çµæ´»ã€ç”Ÿæ€ä¸°å¯Œ | æ€§èƒ½ä¸€èˆ¬ | é€‚åˆå¿«é€ŸåŸå‹ |
| **Django** | åŠŸèƒ½å®Œæ•´ã€ORMå¼ºå¤§ | é‡é‡çº§ | é€‚åˆå¤æ‚ä¸šåŠ¡ |

### æ•°æ®åº“é€‰å‹
| æ•°æ®åº“ | ä¼˜åŠ¿ | åŠ£åŠ¿ | ä½¿ç”¨åœºæ™¯ |
|--------|------|------|----------|
| **PostgreSQL** | åŠŸèƒ½å¼ºå¤§ã€ACIDæ”¯æŒ | é…ç½®å¤æ‚ | ä¸»æ•°æ®åº“ |
| **Redis** | é«˜æ€§èƒ½ã€æ•°æ®ç»“æ„ä¸°å¯Œ | å†…å­˜é™åˆ¶ | ç¼“å­˜ã€ä¼šè¯ |
| **MongoDB** | çµæ´»schemaã€æ°´å¹³æ‰©å±• | ä¸€è‡´æ€§å¼± | æ—¥å¿—ã€åˆ†æ |

### æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹
| æ¶ˆæ¯é˜Ÿåˆ— | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| **RabbitMQ** | å¯é æ€§é«˜ã€åŠŸèƒ½ä¸°å¯Œ | æ€§èƒ½ä¸€èˆ¬ | ä¸šåŠ¡æ¶ˆæ¯ |
| **Apache Kafka** | é«˜ååã€æŒä¹…åŒ– | å¤æ‚åº¦é«˜ | å¤§æ•°æ®æµ |
| **Redis Pub/Sub** | ç®€å•å¿«é€Ÿ | ä¸æŒä¹…åŒ– | å®æ—¶é€šçŸ¥ |

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜ä¼˜åŒ–
```python
# å¤šçº§ç¼“å­˜ç­–ç•¥
class MultiLevelCache:
    def __init__(self):
        self.l1_cache = {}  # å†…å­˜ç¼“å­˜
        self.l2_cache = redis.Redis()  # Redisç¼“å­˜
        self.l3_cache = database  # æ•°æ®åº“
    
    async def get(self, key: str):
        # L1ç¼“å­˜
        if key in self.l1_cache:
            return self.l1_cache[key]
        
        # L2ç¼“å­˜
        result = await self.l2_cache.get(key)
        if result:
            self.l1_cache[key] = result
            return result
        
        # L3æ•°æ®åº“
        result = await self.l3_cache.get(key)
        if result:
            await self.l2_cache.set(key, result, ttl=3600)
            self.l1_cache[key] = result
            return result
        
        return None
```

### 2. å¼‚æ­¥å¤„ç†
```python
# å¼‚æ­¥è¯†åˆ«å¤„ç†
import asyncio
from concurrent.futures import ThreadPoolExecutor

class AsyncRecognitionService:
    def __init__(self):
        self.executor = ThreadPoolExecutor(max_workers=10)
    
    async def recognize_async(self, image_data: bytes) -> str:
        loop = asyncio.get_event_loop()
        result = await loop.run_in_executor(
            self.executor, 
            self._recognize_sync, 
            image_data
        )
        return result
    
    def _recognize_sync(self, image_data: bytes) -> str:
        # åŒæ­¥è¯†åˆ«é€»è¾‘
        return "recognition_result"
```

### 3. è¿æ¥æ± ä¼˜åŒ–
```python
# æ•°æ®åº“è¿æ¥æ± 
from sqlalchemy.pool import QueuePool
from sqlalchemy import create_engine

engine = create_engine(
    "postgresql://user:pass@localhost/captcha",
    poolclass=QueuePool,
    pool_size=20,
    max_overflow=30,
    pool_pre_ping=True,
    pool_recycle=3600
)

# Redisè¿æ¥æ± 
import redis.asyncio as redis

redis_pool = redis.ConnectionPool.from_url(
    "redis://localhost:6379",
    max_connections=20,
    retry_on_timeout=True
)
```

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### Kuberneteséƒ¨ç½²
```yaml
# k8s-deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: text-recognition-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: text-recognition
  template:
    metadata:
      labels:
        app: text-recognition
    spec:
      containers:
      - name: text-recognition
        image: captcha/text-recognition:latest
        ports:
        - containerPort: 8001
        env:
        - name: REDIS_URL
          value: "redis://redis-service:6379"
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8001
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8001
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: text-recognition-service
spec:
  selector:
    app: text-recognition
  ports:
  - port: 8001
    targetPort: 8001
  type: ClusterIP
```

## ğŸ“ æ€»ç»“

æœ¬æ¶æ„æ¼”è¿›æŒ‡å—æä¾›äº†ä»å•ä½“æ¶æ„å‘å¾®æœåŠ¡æ¶æ„è½¬å‹çš„è¯¦ç»†è·¯å¾„ï¼ŒåŒ…æ‹¬ï¼š

1. **æ¸è¿›å¼æ¼”è¿›**: åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½é£é™©
2. **æŠ€æœ¯é€‰å‹**: åŸºäºå®é™…éœ€æ±‚çš„æŠ€æœ¯é€‰æ‹©
3. **æ€§èƒ½ä¼˜åŒ–**: å¤šç»´åº¦çš„æ€§èƒ½æå‡ç­–ç•¥
4. **è¿ç»´ä¿éšœ**: å®Œæ•´çš„ç›‘æ§å’Œéƒ¨ç½²æ–¹æ¡ˆ

é€šè¿‡è¿™ä¸ªæ¼”è¿›è®¡åˆ’ï¼Œå¯ä»¥å°†å½“å‰çš„éªŒè¯ç è¯†åˆ«ç³»ç»Ÿå‡çº§ä¸ºç°ä»£åŒ–çš„ã€å¯æ‰©å±•çš„ã€é«˜å¯ç”¨çš„å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-05-26  
**é€‚ç”¨ç‰ˆæœ¬**: éªŒè¯ç è¯†åˆ«ç³»ç»Ÿ v2.0+
